---
title: "Palettes in Biscale"
author: "Branson Fox and Christopher Prener, Ph.D."
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Palettes in Biscale}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

One of the important aspects of cartography and data visualization is color choice. *As of v1.0.0, `biscale` supports a dozen built-in palettes and expanded ability to utilize custom palettes.* This vignette illustrates the palettes included with `biscale`, provides an overview of palette manipulation tools, and describes the revised approach to utilizing custom palettes.

## Included Palettes
### Primary Palettes
All of the primary palettes listed here can be used with two-by-two (`dim = 2`), three-by-three (`dim = 3`), and four-by-four (`dim = 4`) maps. The palettes that contain a `2` at the end of their name are visually similar to the original, "legacy" palettes (see below) but utilize slightly different hex values for colors. 
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/pals_primary.jpeg')
```

Most of the newly added palettes not based on legacy designs were adapted from earlier work by Branson Fox.

### Legacy Palettes
To ensure compatibility with scripts written with older versions of `biscale`, the original five palettes included in the package are still available. They can be used only for two-by-two (`dim = 2`) and three-by-three (`dim = 3`) maps.

```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/pals_legancy.jpeg')
```

The `"DkViolet"` palette was created by [Timo Grossenbacher and Angelo Zehr](https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/), and the other four palettes were created by [Joshua Stevens](http://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/).

## Palette Manipulations
The native palettes were prior restricted to an exact arrangement. However, there may be a desire to change the axes of the color scale. To do this, you need only supply `flip_axes = TRUE` to `bi_legend`, `bi_scale_fill` or `bi_scale_color`. **Very Important:** this argument must be specified to both your legend function **and** your scale function, or the colors will not align.

Flipping the axes inverts the color scale for the x and y axes. For example:

```r
regular <- bi_pal('DkViolet') + labs(title = 'Regular')
flipped <- bi_pal('DkViolet', flip_axes = TRUE) + labs(title = 'Flipped')
gridExtra::grid.arrange(regular, flipped, ncol = 2)
```
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/flipped_pal.png')
```

Rotating the palette rotates the entire color scale 180 degrees. For example:
```r
regular <- bi_pal('DkViolet') + labs(title = 'Regular')
rotated <- bi_pal('DkViolet', rotate_pal = TRUE) + labs(title = 'Rotated')
gridExtra::grid.arrange(regular, rotated, ncol = 2)
```
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/rotated_pal.png')
```

These techniques can be combined as well, to produce a palette that has been both flipped and rotated.
```r
regular <- bi_pal('DkViolet') + labs(title = 'Regular')
flipped <- bi_pal('DkViolet', flip_axes = TRUE) + labs(title = 'Flipped')
rotated <- bi_pal('DkViolet', rotate_pal = TRUE) + labs(title = 'Rotated')
flipAndRotate <- bi_pal('DkViolet', flip_axes = TRUE, rotate_pal = TRUE) + labs(title = 'Flipped and Rotated')
gridExtra::grid.arrange(regular, flipped, rotated, flipAndRotate, ncol = 2)
```
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/manipulated_pal.png')
```

As you may discern, this can drastically affect the way a bivariate map looks.

```r
data <- bi_class(stl_race_income, x = pctWhite, y = medInc, style = "quantile", dim = 3)
map <- ggplot() +
  geom_sf(data = data, mapping = aes(fill = bi_class), color = 'white', size = 0.1, show.legend = FALSE) +
  bi_theme()
  
regular <- map +
    bi_scale_fill(pal = "DkViolet", dim = 3) +
    labs(title = "Regular")
flipped <- map +
    bi_scale_fill(pal = "DkViolet", dim = 3, flip_axes = TRUE) +
    labs(title = "Flipped")
rotated <- map +
    bi_scale_fill(pal = "DkViolet", dim = 3, rotate_pal = TRUE) +
    labs(title = "Rotated")
flipAndRotate <- map +
    bi_scale_fill(pal = "DkViolet", dim = 3, flip_axes = TRUE, rotate_pal = TRUE) +
    labs(title = "Flipped and Rotated")    

gridExtra::grid.arrange(regular, flipped, rotated, flipAndRotate, ncol = 2)
```
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/palette_maps.png')
```

## Special Palettes
`biscale` now includes some special palettes. The decision to use these palettes depends on the context of data, and this decision is left to the user. However, these consideration may be useful:

* For divergent data (where one axis represents two opposites), consider `bi_pal('Diverging')`
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/diverging_pal.png')
```

* For data with a measure of uncertainty, consider `bi_pal('BlYellow')`
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/blyellow_pal.png')
```

* For categorical data, or for the most accessible palette for distinguishing between classes, consider `bi_pal('Virids')`
```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('../man/figures/viridis_pal.png')
```
