<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bivarite Mapping with ggplot2 • biscale</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bivarite Mapping with ggplot2">
<meta property="og:description" content="">
<meta property="og:image" content="https://slu-openGIS.github.io/biscale/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">biscale</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/biscale.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/slu-openGIS/biscale">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Bivarite Mapping with ggplot2</h1>
                        <h4 class="author">Christopher Prener, Ph.D.</h4>
            
            <h4 class="date">2019-06-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/slu-openGIS/biscale/blob/master/vignettes/biscale.Rmd"><code>vignettes/biscale.Rmd</code></a></small>
      <div class="hidden name"><code>biscale.Rmd</code></div>

    </div>

    
    
<p>Thematic choropleth maps are used to display quantities of some variable within areas, such as mapping median income across a city’s neighborhoods. However, we often think in bivariate terms - “how do race and income vary together?”. Maps that captures this, known as bivariate choropleth maps, are often perceived as difficult to create and interpret. The goal of <code>biscale</code> is to implement a consistent approach to bivariate mapping entirely within <code>R</code>. The package’s workflow is based on a recent <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/">tutorial</a> written by Timo Grossenbacher and Angelo Zehr, and supports both two-by-two and three-by-three bivariate maps.</p>
<p><img src="../man/figures/biscale.001.png" width="100%"></p>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<div id="installation" class="section level3">
<h3 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h3>
<p>Since the package does not directly use functions from <code>sf</code>, it is a suggested dependency rather than a required one. However, the most direct approach to using <code>biscale</code> is with <code>sf</code> objects, and we therefore recommend users install <code>sf</code> before proceeding with using <code>biscale</code>. Windows users should be able to install <code>sf</code> without significant issues, but macOS and Linux users will need to install several open source spatial libraries to get <code>sf</code> itself up and running. The easiest approach for macOS users is to install the GDAL 2.0 Complete framework from <a href="https://www.kyngchaos.com/software/frameworks/">Kyng Chaos</a>.</p>
<p>For Linux users, steps will vary based on the flavor being used. Our <a href="https://github.com/slu-openGIS/biscale/blob/master/.travis.yml">configuration file</a> for Travis CI and its associated <a href="https://github.com/slu-openGIS/biscale/blob/master/.travis/install.sh">bash script</a> should be useful in determining the necessary components to install.</p>
<p>Once <code>sf</code> is installed, the easiest way to get <code>biscale</code> is to install it from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"biscale"</span>)</span></code></pre></div>
<p>Alternatively, the development version of <code>biscale</code> can be accessed from GitHub with <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>remotes<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"slu-openGIS/biscale"</span>)</span></code></pre></div>
</div>
<div id="functions" class="section level3">
<h3 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h3>
<p>All functions within <code>biscale</code> use the prefix <code>bi_</code> to leverage the auto-completion features of RStudio and other IDEs.</p>
</div>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<p><code>biscale</code> contains a data set of U.S. Census tracts for the City of St. Louis in Missouri. Both median income and the percentage of white residents are included, both of which can be used to demonstrate the package’s functionality.</p>
</div>
<div id="preparing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#preparing-data" class="anchor"></a>Preparing Data</h3>
<p>Once data are loaded, bivariate classes can be applied with the <code>bi_class()</code> function. There is an <em>important caveat</em>, however:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># load dependencies</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(biscale)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="op">&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># create classes</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="er">&gt;</span><span class="st"> </span>data &lt;-<span class="st"> </span><span class="kw">bi_class</span>(stl_race_income, <span class="dt">x =</span> pctWhite, <span class="dt">y =</span> medInc, <span class="dt">style =</span> <span class="st">"quantile"</span>, <span class="dt">dim =</span> <span class="dv">3</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>Warning message<span class="op">:</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>In <span class="kw">bi_class</span>(stl_race_income, <span class="dt">x =</span> pctWhite, <span class="dt">y =</span> medInc, <span class="dt">dim =</span> <span class="dv">3</span>) <span class="op">:</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="st">  </span>The <span class="st">'sf'</span> package is not loaded, and the class <span class="st">'sf'</span> attribute of the given data set has been lost. Load <span class="st">'sf'</span> to retain the class when using <span class="st">'bi_class'</span>.</span></code></pre></div>
<p>If you are going to be using <code>sf</code> objects, it is important that you load the <code>sf</code> package as well so that its methods can be correctly applied to your data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="co"># load dependencies</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(biscale)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="op">&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="er">&gt;</span><span class="st"> </span><span class="co"># create classes</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="er">&gt;</span><span class="st"> </span>data &lt;-<span class="st"> </span><span class="kw">bi_class</span>(stl_race_income, <span class="dt">x =</span> pctWhite, <span class="dt">y =</span> medInc, <span class="dt">style =</span> <span class="st">"quantile"</span>, <span class="dt">dim =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>This warning will not be generated if <code>sf</code> is loaded, or if you are using <code>bi_class()</code> on a non-<code>sf</code> object (which leaves room for folks who use other tools like <code>sp</code>, or who are applying classes to tibbles or data frames).</p>
<p>The <code>dim</code> argument is used to control the extent of the legend - do you want to produce a two-by-two map (<code>dim = 2</code>) or a three-by-three map (<code>dim = 3</code>)?</p>
<p>Classes can be applied with the <code>style</code> parameter using four approaches for calculating breaks: <code>"quantile"</code> (default), <code>"equal"</code>, <code>"fisher"</code>, and <code>"jenks"</code>. The default <code>"quantile"</code> approach will create relatively equal “buckets” of data for mapping, with a break created at the median (50th percentile) for a two-by-two map or at the 33rd and 66th percentiles for a three-by-three map.</p>
<p><img src="../man/figures/biscale.004.png" width="100%"></p>
<p>With the sample data, this creates a <em>very</em> broad range for the percent white measure in particular. Using one of the other approaches to calculating breaks yields a narrower range for the breaks and produces a map that does not overstate the percent of white residents living on the north side of St. Louis:</p>
<p><img src="../man/figures/biscale.005.png" width="100%"></p>
</div>
<div id="mapping-data" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-data" class="anchor"></a>Mapping Data</h3>
<p>Once breaks are created, we can use <code>bi_scale_fill()</code> as part of our <code>ggplot()</code> call:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># create map</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>map &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> data, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> bi_class), <span class="dt">color =</span> <span class="st">"white"</span>, <span class="dt">size =</span> <span class="fl">0.1</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">bi_scale_fill</span>(<span class="dt">pal =</span> <span class="st">"DkBlue"</span>, <span class="dt">dim =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="dt">title =</span> <span class="st">"Race and Income in St. Louis, MO"</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="dt">subtitle =</span> <span class="st">"Dark Blue (DkBlue) Palette"</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  ) <span class="op">+</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">  </span><span class="kw">bi_theme</span>()</span></code></pre></div>
<p>This requires that the variable <code>bi_class</code>, created with <code>bi_class()</code>, is used as the fill variable in the aesthetic mapping. We also want to remove the legend from the plot since it will not accurately communicate the complexity of the bivariate scale.</p>
<p>The dimensions of the scale must again be supplied for <code>bi_scale_fill()</code> (they should match the dimensions given for <code>bi_class()</code>!), and a palette must be given. Options for palettes are <code>"Brown"</code>, <code>"DkBlue"</code>, <code>"DkCyan"</code>, <code>"DkViolet"</code>, or <code>"GrPink"</code>. The <code>"DkViolet"</code> was created by <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/">Timo Grossenbacher and Angelo Zehr</a>, and the other four palettes were created by <a href="http://www.joshuastevens.net/cartography/make-a-bivariate-choropleth-map/">Joshua Stevens</a>. The first map in this vignette uses the <code>"GrPink"</code> palette. Other two-by-two palettes look like so:</p>
<p><img src="../man/figures/biscale.002.png" width="100%"></p>
<p>Here are several other three-by-three palettes:</p>
<p><img src="../man/figures/biscale.003.png" width="100%"></p>
<p>The <code>"Brown"</code> palette is not pictured, but can be previewed (along with the other palettes) using the <code>bi_pal()</code> function. The same function can also be used to return vectors of color hex values as well. Samples of each palette are available on the <a href="https://slu-opengis.github.io/biscale/reference/bi_pal.html">package website</a>.</p>
<p>The example above also includes <code>bi_theme()</code>, which is based on the theme designed by <a href="https://timogrossenbacher.ch/2019/04/bivariate-maps-with-ggplot2-and-sf/">Timo Grossenbacher and Angelo Zehr</a>. This theme creates a simple, clean canvas for bivariate mapping that removes any possible distracting elements.</p>
</div>
<div id="creating-legends" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-legends" class="anchor"></a>Creating Legends</h3>
<p>We’ve set <code>show.legend = FALSE</code> so that we can add (manually) our own bivariate legend. The legend itself can be created with the <code>bi_legend()</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>legend &lt;-<span class="st"> </span><span class="kw">bi_legend</span>(<span class="dt">pal =</span> <span class="st">"DkBlue"</span>,</span>
<span id="cb6-2"><a href="#cb6-2"></a>                    <span class="dt">dim =</span> <span class="dv">3</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a>                    <span class="dt">xlab =</span> <span class="st">"Higher % White "</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>                    <span class="dt">ylab =</span> <span class="st">"Higher Income "</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>                    <span class="dt">size =</span> <span class="dv">8</span>)</span></code></pre></div>
<p>The palette and dimensions should match what has been used for both <code>bi_class()</code> (in terms of dimensions) and <code>bi_scale_fill()</code> (in terms of both dimensions and palette). The <code>size</code> argument controls the font size used on the legend. Note that <a href="https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html"><code>plotmath</code></a> is used to draw the arrows since Unicode arrows are font dependent. This happens internally as part of <code>bi_legend()</code> - you don’t need to include them in your <code>xlab</code> and <code>ylab</code> arguments!</p>
<p>With our legend drawn, we can then combine the legend and the map with <code>cowplot</code>. Like <code>sf</code>, <code>cowplot</code> is a suggested rather than required dependency. The values needed for this stage will be subject to experimentation depending on the shape of the map itself.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># combine map with legend</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>finalPlot &lt;-<span class="st"> </span><span class="kw">ggdraw</span>() <span class="op">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw">draw_plot</span>(map, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw">draw_plot</span>(legend, <span class="fl">0.2</span>, <span class="fl">.65</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>)</span></code></pre></div>
<p>This approach allows us to customize legend’s placement and size to suit different map layouts. All of the maps shown as part of this vignette were produced using this approach.</p>
</div>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a>Getting Help</h2>
<ul>
<li>If you are new to <code>R</code> itself, welcome! Hadley Wickham’s <a href="http://r4ds.had.co.nz"><em>R for Data Science</em></a> is an excellent way to get started with data manipulation in the tidyverse, which <code>biscale</code> is designed to integrate seamlessly with.</li>
<li>If you are new to spatial analysis in <code>R</code>, we strongly encourage you check out the excellent new <a href="https://geocompr.robinlovelace.net"><em>Geocomputation in R</em></a> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow.</li>
<li>If you have questions about using <code>biscale</code>, you are encouraged to use the <a href="https://community.rstudio.com">RStudio Community forums</a>. Please create a <a href="http://reprex.tidyverse.org/"><code>reprex</code></a> before posting. Feel free to tag Chris (<code>@chris.prener</code>) in any posts about <code>biscale</code>.</li>
<li>If you think you’ve found a bug, please create a <a href="http://reprex.tidyverse.org/"><code>reprex</code></a> and then open an issue on <a href="https://github.com/slu-openGIS/biscale/issues/new/choose">GitHub</a>.</li>
</ul>
</div>
<div id="suggesting-features-or-changes" class="section level2">
<h2 class="hasAnchor">
<a href="#suggesting-features-or-changes" class="anchor"></a>Suggesting Features or Changes</h2>
<p>If you have features or suggestions you want to see implemented, please open an issue on <a href="https://github.com/slu-openGIS/biscale/issues/new/choose">GitHub</a> (and ideally created a <a href="http://reprex.tidyverse.org/"><code>reprex</code></a> to go with it!). Please note that this project is released with a <a href="https://slu-opengis.github.io/biscale/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#getting-started">Getting Started</a></li>
      <li><a href="#getting-help">Getting Help</a></li>
      <li><a href="#suggesting-features-or-changes">Suggesting Features or Changes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://chris-prener.github.io">Christopher Prener</a>, Timo Grossenbacher, Angelo Zehr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
